<script>
    import { navigating } from '$app/stores';
    import { page } from '$app/stores';
	import { slide } from 'svelte/transition';

    import { mobileWidthhTreshhold } from '$lib/stores/config';
    import LinkButton from '$lib/components/buttons/LinkButton.svelte';
    import ThemeSwitch from "$lib/components/buttons/ThemeSwitch.svelte";
    import SwitchingIcon from './SwitchingIcon.svelte';

    $: if($navigating) isOpen = false;
    $: currentPath = $page.url.pathname;
    
    const navItems = [
        {
            href: '/rekrutacja',
            label: 'Rekrutacja'
        },
        {
            href: '/o-szkole',
            label: 'O Szkole'
        },
        {
            href: '/dla-ucznia',
            label: 'Dla Ucznia'
        },
        {
            href: '/aktualnosci',
            label: 'Aktualno≈õci'
        },
        {
            href: '/kontakt',
            label: 'Kontakt'
        },
    ];
    
    let scrollY;

    let isOpen = false;
    let screenWidth;
    $: isMobile = screenWidth <= mobileWidthhTreshhold;

    const handleMobileIconClick = () => {isOpen = !isOpen}
</script>

<svelte:window bind:scrollY={scrollY} bind:innerWidth={screenWidth}/>

<nav class:shadow={(scrollY !== 0 && !isMobile) || isOpen}>
    {#if isMobile}
        <div class="mobile-bar" class:shadow={scrollY !== 0 || isOpen}>
            <div class="logo">
                <a sveltekit:prefetch href="/">
                    <svg width="100%" height="100%" viewBox="0 0 400 400" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                        <g transform="matrix(1.10683,0,0,1.10683,-21.3652,-20.983)">
                            <path d="M207.008,44.542L213.747,44.542L315.674,342.523L304.716,359.068L301.477,380.352L297.625,358.853L297.625,341.019L199.243,56.746L101.234,344.027L85.119,368.952L84.722,339.12L183.713,44.322L191.167,44.322L191.167,33.153C190.287,31.733 189.78,30.058 189.78,28.266C189.78,23.128 193.95,18.958 199.087,18.958C204.225,18.958 208.395,23.128 208.395,28.266C208.395,30.058 207.888,31.733 207.008,33.153L207.008,44.542ZM128.041,270.096C145.373,290.453 171.189,303.376 200,303.376C228.623,303.376 254.29,290.621 271.627,270.484L284.686,308.218L275.48,300.686C273.418,302.382 271.3,304.007 269.128,305.56L279.074,327.599C274.004,330.976 268.723,334.025 263.264,336.727L249.15,317.094C246.72,318.198 244.253,319.22 241.754,320.158L245.657,344.02C239.886,345.97 233.996,347.548 228.023,348.745L219.472,326.128C216.838,326.566 214.191,326.914 211.534,327.173L209.128,351.232C203.049,351.622 196.951,351.622 190.872,351.232L188.466,327.173C185.809,326.914 183.162,326.566 180.528,326.128L171.977,348.745C166.004,347.548 160.114,345.97 154.343,344.02L158.246,320.158C155.747,319.22 153.28,318.198 150.85,317.094L136.736,336.727C131.277,334.025 125.996,330.976 120.926,327.599L130.872,305.56C128.7,304.007 126.582,302.382 124.52,300.686L114.928,308.534L128.041,270.096ZM301.376,296.089L304.686,305.766C305.503,304.884 306.308,303.991 307.102,303.088L301.376,296.089ZM96.869,298.234L92.898,303.088C93.46,303.727 94.027,304.361 94.6,304.989L96.869,298.234ZM225.76,75.028L228.023,69.044C233.996,70.241 239.886,71.819 245.657,73.769L241.754,97.631C244.253,98.569 246.72,99.591 249.15,100.695L263.264,81.062C268.723,83.764 274.004,86.813 279.074,90.19L269.128,112.229C271.3,113.782 273.418,115.407 275.48,117.103L294.194,101.792C298.768,105.815 303.08,110.127 307.102,114.701L291.792,133.415C293.487,135.477 295.113,137.595 296.665,139.766L318.704,129.821C322.081,134.89 325.13,140.171 327.832,145.631L308.199,159.744C309.304,162.174 310.325,164.641 311.263,167.141L335.125,163.238C337.075,169.009 338.653,174.899 339.85,180.872L317.234,189.423C317.671,192.056 318.02,194.704 318.279,197.36L342.338,199.767C342.728,205.846 342.728,211.943 342.338,218.022L318.279,220.429C318.02,223.086 317.671,225.733 317.234,228.366L339.85,236.917C338.653,242.89 337.075,248.78 335.125,254.551L311.263,250.649C310.325,253.148 309.304,255.615 308.199,258.045L327.832,272.158C325.13,277.618 322.081,282.899 318.704,287.968L296.665,278.023C296.336,278.484 296.003,278.942 295.667,279.398L285.391,249.356C291.219,237.09 294.482,223.37 294.482,208.895C294.482,172.121 273.428,140.227 242.722,124.616L225.76,75.028ZM172.958,71.639L154.714,125.969C125.407,142.022 105.518,173.154 105.518,208.895C105.518,222.718 108.494,235.853 113.84,247.694L103.553,278.327L103.335,278.023L81.296,287.968C77.919,282.899 74.87,277.618 72.168,272.158L91.801,258.045C90.696,255.615 89.675,253.148 88.737,250.649L64.875,254.551C62.925,248.78 61.347,242.89 60.15,236.917L82.766,228.366C82.329,225.733 81.98,223.086 81.721,220.429L57.662,218.022C57.272,211.943 57.272,205.846 57.662,199.767L81.721,197.36C81.98,194.704 82.329,192.056 82.766,189.423L60.15,180.872C61.347,174.899 62.925,169.009 64.875,163.238L88.737,167.141C89.675,164.641 90.696,162.174 91.801,159.744L72.168,145.631C74.87,140.171 77.919,134.89 81.296,129.821L103.335,139.766C104.887,137.595 106.513,135.477 108.208,133.415L92.898,114.701C96.92,110.127 101.232,105.815 105.806,101.792L124.52,117.103C126.582,115.407 128.7,113.782 130.872,112.229L120.926,90.19C125.996,86.813 131.277,83.764 136.736,81.062L150.85,100.695C153.28,99.591 155.747,98.569 158.246,97.631L154.343,73.769C160.114,71.819 166.004,70.241 171.977,69.044L172.958,71.639ZM197.573,66.285C198.699,66.266 199.825,66.26 200.95,66.268L218.222,116.172C212.323,115.017 206.231,114.413 200,114.413C193.304,114.413 186.771,115.111 180.463,116.439L197.573,66.285Z" />
                        </g>
                    </svg>
                </a>
            </div>
            <div class="mobile-buttons">
                <ThemeSwitch />
                <div class="mobile-icon" on:click={handleMobileIconClick}>
                    <SwitchingIcon condition={isOpen} ifTrue="close" ifFalse="menu"/>
                </div>
            </div>
        </div>
    {/if}

    {#if !isMobile || isOpen}
        <ul class:mobile={isMobile} transition:slide={{ duration: isMobile ? 250 : 0 }}>
            {#if !isMobile}
                <li class="logo">
                    <a sveltekit:prefetch href="/">
                        <svg width="100%" height="100%" viewBox="0 0 400 400" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                            <g transform="matrix(1.10683,0,0,1.10683,-21.3652,-20.983)">
                                <path d="M207.008,44.542L213.747,44.542L315.674,342.523L304.716,359.068L301.477,380.352L297.625,358.853L297.625,341.019L199.243,56.746L101.234,344.027L85.119,368.952L84.722,339.12L183.713,44.322L191.167,44.322L191.167,33.153C190.287,31.733 189.78,30.058 189.78,28.266C189.78,23.128 193.95,18.958 199.087,18.958C204.225,18.958 208.395,23.128 208.395,28.266C208.395,30.058 207.888,31.733 207.008,33.153L207.008,44.542ZM128.041,270.096C145.373,290.453 171.189,303.376 200,303.376C228.623,303.376 254.29,290.621 271.627,270.484L284.686,308.218L275.48,300.686C273.418,302.382 271.3,304.007 269.128,305.56L279.074,327.599C274.004,330.976 268.723,334.025 263.264,336.727L249.15,317.094C246.72,318.198 244.253,319.22 241.754,320.158L245.657,344.02C239.886,345.97 233.996,347.548 228.023,348.745L219.472,326.128C216.838,326.566 214.191,326.914 211.534,327.173L209.128,351.232C203.049,351.622 196.951,351.622 190.872,351.232L188.466,327.173C185.809,326.914 183.162,326.566 180.528,326.128L171.977,348.745C166.004,347.548 160.114,345.97 154.343,344.02L158.246,320.158C155.747,319.22 153.28,318.198 150.85,317.094L136.736,336.727C131.277,334.025 125.996,330.976 120.926,327.599L130.872,305.56C128.7,304.007 126.582,302.382 124.52,300.686L114.928,308.534L128.041,270.096ZM301.376,296.089L304.686,305.766C305.503,304.884 306.308,303.991 307.102,303.088L301.376,296.089ZM96.869,298.234L92.898,303.088C93.46,303.727 94.027,304.361 94.6,304.989L96.869,298.234ZM225.76,75.028L228.023,69.044C233.996,70.241 239.886,71.819 245.657,73.769L241.754,97.631C244.253,98.569 246.72,99.591 249.15,100.695L263.264,81.062C268.723,83.764 274.004,86.813 279.074,90.19L269.128,112.229C271.3,113.782 273.418,115.407 275.48,117.103L294.194,101.792C298.768,105.815 303.08,110.127 307.102,114.701L291.792,133.415C293.487,135.477 295.113,137.595 296.665,139.766L318.704,129.821C322.081,134.89 325.13,140.171 327.832,145.631L308.199,159.744C309.304,162.174 310.325,164.641 311.263,167.141L335.125,163.238C337.075,169.009 338.653,174.899 339.85,180.872L317.234,189.423C317.671,192.056 318.02,194.704 318.279,197.36L342.338,199.767C342.728,205.846 342.728,211.943 342.338,218.022L318.279,220.429C318.02,223.086 317.671,225.733 317.234,228.366L339.85,236.917C338.653,242.89 337.075,248.78 335.125,254.551L311.263,250.649C310.325,253.148 309.304,255.615 308.199,258.045L327.832,272.158C325.13,277.618 322.081,282.899 318.704,287.968L296.665,278.023C296.336,278.484 296.003,278.942 295.667,279.398L285.391,249.356C291.219,237.09 294.482,223.37 294.482,208.895C294.482,172.121 273.428,140.227 242.722,124.616L225.76,75.028ZM172.958,71.639L154.714,125.969C125.407,142.022 105.518,173.154 105.518,208.895C105.518,222.718 108.494,235.853 113.84,247.694L103.553,278.327L103.335,278.023L81.296,287.968C77.919,282.899 74.87,277.618 72.168,272.158L91.801,258.045C90.696,255.615 89.675,253.148 88.737,250.649L64.875,254.551C62.925,248.78 61.347,242.89 60.15,236.917L82.766,228.366C82.329,225.733 81.98,223.086 81.721,220.429L57.662,218.022C57.272,211.943 57.272,205.846 57.662,199.767L81.721,197.36C81.98,194.704 82.329,192.056 82.766,189.423L60.15,180.872C61.347,174.899 62.925,169.009 64.875,163.238L88.737,167.141C89.675,164.641 90.696,162.174 91.801,159.744L72.168,145.631C74.87,140.171 77.919,134.89 81.296,129.821L103.335,139.766C104.887,137.595 106.513,135.477 108.208,133.415L92.898,114.701C96.92,110.127 101.232,105.815 105.806,101.792L124.52,117.103C126.582,115.407 128.7,113.782 130.872,112.229L120.926,90.19C125.996,86.813 131.277,83.764 136.736,81.062L150.85,100.695C153.28,99.591 155.747,98.569 158.246,97.631L154.343,73.769C160.114,71.819 166.004,70.241 171.977,69.044L172.958,71.639ZM197.573,66.285C198.699,66.266 199.825,66.26 200.95,66.268L218.222,116.172C212.323,115.017 206.231,114.413 200,114.413C193.304,114.413 186.771,115.111 180.463,116.439L197.573,66.285Z" />
                            </g>
                        </svg>
                    </a>
                </li>
            {/if}

            {#each navItems as item}
                <li>
                    <a sveltekit:prefetch href={item.href} class:active={currentPath.startsWith(item.href)}>{item.label}</a>
                </li>
            {/each}
                
            <li class="separate">
                {#if !isMobile}
                    <ThemeSwitch />
                {/if}
                <LinkButton href={"https://uonetplus.vulcan.net.pl/powiatlukowski/"} target={"_blank"}>
                    E-dziennik
                </LinkButton>
            </li>
        </ul>
    {/if}
</nav>

<style>
    nav {
        position: fixed;
        top: 0;
        width: 100%;
        background-color: var(--main);

        transition: box-shadow ease .25s;
        z-index: 1;
    }
    /* Mobile bar */
    .mobile-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1em;
        transition: box-shadow ease .25s;
    }

    .mobile-buttons {
        display: flex;
        gap: 1em;
    }

    .mobile-icon{
        display: flex;
        align-items: center;
        padding: .25em;
        --icon-size: 2em;
    }

    /* Navigation */
    ul {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1em;
        width: 100%;
        list-style: none;
    }
  
    ul:not(.mobile) .logo {
        margin-right: auto;
    }

    .logo a {
        padding: 0;
    }

    .logo svg {
        height: 3em;
        aspect-ratio: 1;
    }

    .logo path {
        fill: var(--text);
    }
    
    li a {
        display: block;
        position: relative;
        padding: 1em;
        text-transform: uppercase;
        font-weight: bold;

    }

    li:not(.logo) a::after {
        content: '';

        position: absolute;
        left: 0;
        bottom: 0;

        width: 100%;
        height: 4px;

        background-color: var(--accent);

        border-radius: 2px;

        transform: scaleX(0);
        transform-origin: center;
        transition: transform .15s ease-out;

    }

    li:not(.logo) a:hover::after {
        transform: scaleX(1) !important;
    }

    li:not(.logo) a.active::after {
        transform: scaleX(0.5);
    }

    ul.mobile .separate {
        margin-top: 10px;
    }

    ul:not(.mobile) .separate {
        margin-left: auto;
        display: flex;
        gap: 1em;
    }

    ul.mobile {
        flex-direction: column;
        justify-content: start;
        max-height: calc(100vh - 4.9em);
        padding-bottom: 3em;
        text-align: center;
        overflow-y: auto;
    }

    .shadow {
        box-shadow: 0 4px 4px 0 rgba(0, 0, 0, 0.2);
    }
</style>